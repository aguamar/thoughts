#!/bin/bash
# Generate Makefile for third-party image download
#
#  Copyright (C) 2017 Mike Gerwitz
#
#  This program is free software: you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation, either version 3 of the License, or
#  (at your option) any later version.
#
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#
#  You should have received a copy of the GNU General Public License
#  along with this program.  If not, see <http://www.gnu.org/licenses/>.
##

declare -r remote_file=remote-list

cat <<EOF
### GENERATED BY gen-makefile ###

TORIFY="${TORIFY-torify}"

images := $( cut -d' ' -f1 "$remote_file" | tr '\n' ' '  )

.PHONY: all check clean

all: \$(images)
SHA256SUM: \$(images)
	sha256sum \$(images) > \$@

check:
	sha256sum -c SHA256SUM

clean:
	\$(RM) \$(images)

EOF

while read out url convert; do
  dest="$out"

  echo "$dest":
  printf "\t\$(TORIFY) wget -O %q %q\n" "$dest" "$url"

  test -n "$convert" || continue

  # faketime because of EXIF metadata
  printf "\tfaketime 1970-01-01 mogrify %s %q\n" "$convert" "$dest"
done < "$remote_file"

